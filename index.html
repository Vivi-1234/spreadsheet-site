<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 标题将由JS动态填充 -->
    <title>SpreadSheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Manrope', 'Inter', sans-serif; background-color: #ffffff; }
        .nav-link { position: relative; transition: color 0.3s ease; }
        .nav-link:after { content: ''; position: absolute; width: 0; height: 1.5px; display: block; margin-top: 4px; right: 0; background: #111827; transition: width 0.3s ease; }
        .nav-link:hover:after { width: 100%; left: 0; }
        .product-card { background-color: #ffffff; border: 1px solid #f0f0f0; transition: all 0.3s ease-in-out; }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px -5px #1118271a; border-color: #e5e7eb; }
        .product-card .img-wrapper { overflow: hidden; }
        .product-card img { transition: transform 0.4s ease; }
        .product-card:hover img { transform: scale(1.05); }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 1rem; background-color: #e5e7eb; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .social-icon-bubble { transition: transform 0.3s ease; }
        .social-icon-bubble:hover { transform: scale(1.1); }
        .fade-in-up { opacity: 0; transform: translateY(20px); transition: opacity 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .fade-in-up.visible { opacity: 1; transform: translateY(0); }
        .discount-badge { position: absolute; top: 1rem; right: 1rem; background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
    </style>
</head>
<body class="text-neutral-800 antialiased">
    <!-- 浮动社交媒体图标 -->
    <div id="social-icons-container" class="fixed right-0 top-1/2 -translate-y-1/2 z-40 flex flex-col items-center space-y-3 mr-2 md:mr-4"></div>

    <!-- 导航栏 -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-30 border-b border-neutral-200/70">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-xl font-bold tracking-tighter text-neutral-900">SpreadSheet</a>
            <nav id="navigation-container" class="hidden md:flex items-center space-x-10"></nav>
            <button class="md:hidden"><i data-lucide="menu" class="w-6 h-6 text-neutral-600"></i></button>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-6">
        <!-- 英雄区 -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-x-16 gap-y-10 items-center my-12 md:my-16 fade-in-up">
            <div class="text-center lg:text-left">
                <h1 id="site-title" class="text-4xl md:text-5xl font-extrabold text-neutral-900 tracking-tighter leading-tight"></h1>
                <p id="site-subtitle" class="mt-4 text-neutral-500 max-w-lg mx-auto lg:mx-0 text-base"></p>
                <div class="mt-6 max-w-sm mx-auto lg:mx-0 relative"><i data-lucide="search" class="w-4 h-4 text-neutral-400 absolute left-4 top-1/2 -translate-y-1/2"></i><input type="text" placeholder="Search brands, styles, and more" class="w-full bg-neutral-100/70 border border-transparent rounded-lg py-3 pl-10 pr-4 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:bg-white transition-colors"></div>
            </div>
            <div class="w-full"><div id="video-wrapper" class="video-container shadow-xl shadow-neutral-200/80"></div></div>
        </section>

        <!-- 产品展示区 -->
        <section class="pt-8 md:pt-12 fade-in-up" style="transition-delay: 200ms;">
            <h2 id="product-section-title" class="text-2xl font-bold text-center mb-10 tracking-tight"></h2>
            <div id="product-list-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-8"></div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white mt-24 border-t border-neutral-200/70"><div class="container mx-auto px-6 py-12 text-center"><p class="font-bold text-lg mb-3">SpreadSheet</p><p class="text-neutral-500 text-sm max-w-md mx-auto">一个致力于发现和推荐 Mulebuy 优质好物的社区。加入我们，发现你的下一双心动好鞋。</p><div class="mt-8 pt-8 border-t border-neutral-200/70 text-xs text-neutral-400"><p>&copy; 2024 SpreadSheet. All Rights Reserved.</p></div></div></footer>

    <script type="module">
        const SUPABASE_URL = 'https://xfkattyyvnbmgnqqsvms.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhma2F0dHl5dm5ibWducXFzdm1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NjYzNzQsImV4cCI6MjA2NjQ0MjM3NH0.z21tfMKKMYB66juOKIYui2uRM5xUjRE_VisNJcxCsWw';

        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- 数据加载和渲染 ---
        async function loadAndRender() {
            const [settingsRes, navRes, socialRes, productsRes] = await Promise.all([
                db.from('settings').select('*').limit(1).single(),
                db.from('navigation').select('*').order('display_order'),
                db.from('social_links').select('*').order('display_order'),
                db.from('products').select('*').eq('is_active', true).order('display_order')
            ]);
            
            // 渲染全局设置
            const settings = settingsRes.data;
            if (settings) {
                document.title = settings.site_title;
                document.getElementById('site-title').innerHTML = settings.site_title.replace('Next', '<br>Next');
                document.getElementById('site-subtitle').textContent = settings.site_subtitle;
                document.getElementById('product-section-title').textContent = settings.product_section_title;
                document.getElementById('video-wrapper').innerHTML = `<iframe src="${settings.video_url}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            }

            // 渲染导航栏
            const navigation = navRes.data;
            const navContainer = document.getElementById('navigation-container');
            navContainer.innerHTML = '';
            if(navigation) navigation.forEach(link => navContainer.innerHTML += `<a href="${link.link_url}" class="nav-link text-sm font-medium text-neutral-500 hover:text-neutral-900">${link.link_text}</a>`);

            // 渲染社交图标
            const socialLinks = socialRes.data;
            const socialContainer = document.getElementById('social-icons-container');
            socialContainer.innerHTML = '';
            if(socialLinks) socialLinks.forEach(link => {
                 socialContainer.innerHTML += `<a href="${link.link_url}" target="_blank" class="social-icon-bubble w-11 h-11 flex items-center justify-center rounded-full shadow-md" style="background-color: ${link.icon_color || '#333'};" title="${link.platform_name}"><i data-lucide="${link.icon_svg_name || 'link'}" class="w-5 h-5 text-white"></i></a>`
            });

            // 渲染产品列表
            const products = productsRes.data;
            const productContainer = document.getElementById('product-list-container');
            productContainer.innerHTML = '';
            if(products) products.forEach(p => {
                const now = new Date();
                const expiry = p.discount_expires_at ? new Date(p.discount_expires_at) : null;
                const showDiscount = p.discount_is_active && p.discount_price && (!expiry || expiry > now);
                
                let priceHTML = `<p class="font-bold text-lg text-neutral-900 mt-1">¥${p.price}</p>`;
                if (showDiscount) {
                    priceHTML = `<p class="font-bold text-lg text-red-600 mt-1">¥${p.discount_price} <span class="text-sm text-gray-400 font-normal line-through ml-1">¥${p.price}</span></p>`;
                }
                
                productContainer.innerHTML += `
                    <a href="${p.target_url}" target="_blank" class="group block rounded-xl product-card relative">
                        <div class="img-wrapper rounded-t-xl"><img src="${p.image_url}" alt="${p.name}" class="w-full h-64 object-cover"></div>
                        <div class="p-4">
                            <h3 class="font-semibold text-base text-neutral-800 truncate group-hover:text-blue-600 transition-colors">${p.name}</h3>
                            ${priceHTML}
                        </div>
                        ${showDiscount ? '<div class="discount-badge">折扣</div>' : ''}
                    </a>
                `;
            });
            
            lucide.createIcons();
            // 渲染淡入动画
            const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('visible'); observer.unobserve(entry.target); } }); }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));
        }

        // --- 初始化 ---
        loadAndRender();
    </script>
</body>
</html>
